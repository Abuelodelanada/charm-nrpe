#!/usr/bin/python
""" Call with a single argument to read that yaml and print out the merge. """

import sys
import subprocess
import yaml

from recursive_dictionary import RecursiveDictionary

if len(sys.argv) > 1:
    mon_yaml = yaml.safe_load(open(sys.argv[1]))
else:
    mon_yaml = yaml.safe_load(subprocess.check_output(['config-get','monitors']))

if mon_yaml != '' and mon_yaml is not None:
    base_yaml = RecursiveDictionary(yaml.safe_load(open('base-monitors.yaml','r')))
    base_yaml.rec_update(mon_yaml)
    base_yaml = dict(base_yaml)
    mon_yaml = dict(base_yaml)

if len(sys.argv) > 1:
    print yaml.safe_dump(mon_yaml)
    sys.exit(0)

with open('monitors.yaml','w') as end_yaml:
    yaml.safe_dump(mon_yaml, end_yaml)
